<!-- Question introduction -->
<pl-question-panel>
    Given the following relational schema, write queries in SQL to answer the English question.

    <markdown>
        customer(cid: integer, cname: string, address: string, city: string, state: string)
        product(pid: integer, pname: string, price: currency, inventory: integer)
        shipment(sid: integer, cid: integer, shipdate: DateTime)
        shippedproduct(sid: integer, pid: integer, amount: integer)
    </markdown>
</pl-question-panel>

<!-- Start Part 1 -->

<!-- Question text -->
<pl-question-panel>
    For each city, return the number of customers in that city and the number of shipments for customers in that city. Hint: COUNT(DISTINCT <em>field</em>) may be useful. Only show cities with at least 2 shipments. Order by number of shipments descending.
    <br>
    Expected Output:
    <br>
    <markdown>
        +------------------+--------------+--------------+
        | city             | numCustomers | numShipments |
        +------------------+--------------+--------------+
        | Hollywood        |            1 |            4 |
        | Iowa City        |            2 |            4 |
        | Kelowna          |            2 |            4 |
        | Lake Country     |            1 |            3 |
        | Calgary          |            1 |            2 |
        | Huntington Beach |            1 |            2 |
        +------------------+--------------+--------------+
    </markdown>
</pl-question-panel>


<!-- SQL editor -->
<pl-sql-element database = "./SQLElementSharedLibrary/lab3Databases/lab3_db.txt">
    <sql-question>
    </sql-question>
    
    <sql-answer answer = "SELECT c.city, COUNT(DISTINCT c.cid) AS customer_count, COUNT(DISTINCT s.sid) AS shipment_count 
FROM customer c LEFT JOIN shipment s 
    ON c.cid = s.cid 
GROUP BY c.city 
HAVING COUNT(DISTINCT s.sid) >= 2 
ORDER BY shipment_count DESC;"
    </sql-answer>

    <sql-marking >
    </sql-marking>
</pl-sql-element>

<!-- End Part 1 -->
