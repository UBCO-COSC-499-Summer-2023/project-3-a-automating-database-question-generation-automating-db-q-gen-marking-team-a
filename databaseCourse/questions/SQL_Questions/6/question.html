<!-- Question introduction -->
<pl-question-panel>
    Given the following relational schema, write queries in SQL to answer the English question.

    <markdown>
        customer(cid: integer, cname: string, address: string, city: string, state: string)
        product(pid: integer, pname: string, price: currency, inventory: integer)
        shipment(sid: integer, cid: integer, shipdate: DateTime)
        shippedproduct(sid: integer, pid: integer, amount: integer)
    </markdown>
</pl-question-panel>

<!-- Start Part 1 -->

<!-- Question text -->
<pl-question-panel>
    Return the top 5 products for state <strong>'BC'</strong> based on shipment revenue (<strong>amount*price</strong>) for the year <strong>2021</strong>.
    <br>
    Expected Output:
    <br>
    <markdown>
        +-------+------+-------------------------+-----------+
        | state | year | pname                   | revenue   |
        +-------+------+-------------------------+-----------+
        | BC    | 2021 | Sports Car              | 247000.00 |
        | BC    | 2021 | Table                   |   6500.00 |
        | BC    | 2021 | Textbook                |    500.00 |
        | BC    | 2021 | Deluxe Sweet Collection |    326.50 |
        | BC    | 2021 | Teddy Bear              |    103.92 |
        +-------+------+-------------------------+-----------+
    </markdown>
    <br>
    Note: PrairieLearn uses SQLite. To extract year from DATETIME see the following link: <a href="https://database.guide/how-to-extract-the-day-month-and-year-from-a-date-in-sqlite/">Extract Year in SQLite</a>
</pl-question-panel>


<!-- SQL editor -->
<pl-sql-element database = "./SQLElementSharedLibrary/lab3Databases/lab3_db.txt">
    <sql-question>
    </sql-question>
    
    <sql-answer>SELECT state, strftime('%Y', shipment.shipdate) AS year, product.pname, SUM(shippedproduct.amount * product.price) AS revenue  
        FROM customer JOIN shipment
            on customer.cid = shipment.cid
            JOIN shippedproduct
                ON shippedproduct.sid = shipment.sid
            JOIN product
                ON shippedproduct.pid = product.pid 
        WHERE state = 'BC' AND strftime('%Y', shipment.shipdate) = '2021'
        GROUP BY product.pname
        ORDER BY revenue DESC
        LIMIT 5;</sql-answer>

    <sql-marking >
    </sql-marking>
</pl-sql-element>

<!-- End Part 1 -->
